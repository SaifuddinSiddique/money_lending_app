<div class="container mt-4">
  <h1 class="mb-4">Admin Dashboard - Loan Requests</h1>

  <div class="alert alert-primary" role="alert">
    <strong>Wallet Balance:</strong> ₹<%= @wallet_balance %>
  </div>

  <% if @loans.any? %>
    <div class="row">
      <% @loans.each do |loan| %>
        <div class="col-md-5">
          <div class="card mb-4 shadow-sm">
            <div class="card-body">
              <p><strong>User:</strong> <%= loan.user.email %></p>
              <p><strong>Requested Amount:</strong> ₹<%= loan.amount %></p>
              <p><strong>Interest Rate:</strong> <%= loan.interest_rate %>%</p>
              <p><strong>Status:</strong> <%= loan.state.humanize %></p>

              <% if loan.requested? %>
                <div class="d-flex flex-wrap gap-2">
                  <%= link_to "Approve without changes", approve_admin_loan_path(loan), data: { turbo_method: :post }, class: "btn btn-success btn-sm" %>
                    <%= link_to "Reject", reject_admin_loan_path(loan), data: { turbo_method: :post, turbo_confirm: "Are you sure?" }, class: "btn btn-danger btn-sm" %>
                  <%= link_to "Adjust", edit_admin_loan_path(loan), data: { turbo: false }, class: "btn btn-warning btn-sm" %>
                </div>
              <% elsif loan.readjustment_requested? %>
                <div class="d-flex flex-wrap gap-2">
                  <%= link_to "Adjust Again", edit_admin_loan_path(loan), data: { turbo: false }, class: "btn btn-warning btn-sm" %>
                  <%= link_to "Reject Readjustment", reject_admin_loan_path(loan), data: { turbo_method: :post, confirm: "Reject Readjustment?" }, class: "btn btn-danger btn-sm" %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="alert alert-info mt-4">
      No loan requests found.
    </div>
  <% end %>

  <div class="mt-3">
    <%= link_to "Log Out", destroy_user_session_path, data: { turbo_method: :delete, turbo_confirm: "Are you sure you want Log Out" }, class: "btn btn-outline-danger" %>
  </div>
</div>
